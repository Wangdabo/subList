<!-- 样式-->
<style>
    table tr th, table tr td { border:1px solid #ccc; height: 30px;line-height: 30px}
</style>

<pro-header></pro-header>

<!--引入list组件-->
<nz-card [nzBordered]="false">
    <!--  form表单搜索 -->


    <app-list #child [initDate]="data" [configTitle]="configTitle" [showAdd]="showAdd" [isPagination]="isPagination"  [buttons] ='buttons' (addCreat)="addHandler($event)" (buttonData)="buttonDataHandler($event)" (pageNumber)="monitorHandler($event)"
              (deleatData)="deleatData($event)" (isActive)="isActive($event)" (buttonEvent)="buttonEvent($event)" (selectedRow)="selectedRow($event)" [headerDate]="headerDate"
              [moreData]="moreData" [total]="total" [pageTotal] = 'pageTotal'></app-list>
</nz-card>


<nz-modal [nzVisible]="iStouchan"  [nzWidth]="1024" [nzTitle]="'工作项投放申请'" nzZIndex=1000  [nzContent]="detailVisibleModalModal"
          (nzOnCancel)="iStouchan=false" (nzOnOk)="checkSave()">
    <ng-template #detailVisibleModalModal>

          <form nz-form (ngSubmit)="addsubmit()" [nzLayout]="'inline'">
            <div nz-row [nzGutter]="24">

                <div  nz-col [nzSpan]="24" class="mb-md">
                    <div nz-form-item class="d-flex">
                        <div nz-form-label nz-col [nzSpan]="8" ><label for="status">投放申请GUID</label></div>
                        <div nz-form-control class="flex-1">
                           <nz-select style="width:100%;" [(ngModel)]="guidDelivery" name="guidDelivery" nzId="guidDelivery" [nzPlaceHolder]="'开发分支'" [nzShowSearch]="true" [nzSize]="'large'">
                            <nz-option *ngFor="let i of guidprent; let idx = index" [nzLabel]="i.guidWorkitem" [nzValue]="i.guid"></nz-option>
                        </nz-select>
                        </div>
                    </div>
                </div>

                <div nz-col [nzSpan]="24" class="mb-md">
                    <div nz-form-item class="d-flex">
                        <div nz-form-label nz-col [nzSpan]="8"><label for="patchType">导出类型</label></div>
                        <div nz-form-control class="flex-1">
                            <nz-input [(ngModel)]="patchType" name="patchType" [nzSize]="'large'" [nzPlaceHolder]="'导出类型'" nzId="patchType"></nz-input>
                        </div>
                    </div>
                </div>

                 <div nz-col [nzSpan]="24" class="mb-md">
                    <div nz-form-item class="d-flex">
                        <div nz-form-label nz-col [nzSpan]="8"><label for="deployWhere">部署于</label></div>
                        <div nz-form-control class="flex-1">
                            <nz-input [(ngModel)]="deployWhere" name="deployWhere" [nzSize]="'large'" [nzPlaceHolder]="'部署于'" nzId="deployWhere"></nz-input>
                        </div>
                    </div>
                </div>

            </div>
        </form>
    </ng-template>
</nz-modal>


<nz-modal [nzVisible]="detailVisible"   [nzWidth]="1024" [nzTitle]="'工作项投放申请'" nzZIndex=10 [nzContent]="detailVisibleModal"
          (nzOnCancel)="detailVisible=false" (nzOnOk)="checkSave()">
    <ng-template #detailVisibleModal>
             <div nz-col [nzSpan]="24" class="mb-md">
                <div  nz-form-item class="d-flex">
                 <button nz-col [nzSpan]="5" [nzOffset]="2" nz-button [nzType]="'default'"  (click)="mergeClick(0)">
                    <span>暂缓核对</span>
                </button>
                   <button nz-col [nzSpan]="5" [nzOffset]="2"  nz-button [nzType]="'danger'"  (click)="mergeClick(1)">
                    <span>作废核对</span>
                </button>
                  <button nz-col [nzSpan]="5" [nzOffset]="2" nz-button [nzType]="'primary'"  (click)="mergeClick(2)">
                    <span>完成核对</span>
                </button>
                </div>
            </div>
        <div >

        <div nz-row [nzType]="'flex'" [nzJustify]="'start'" nz-col [nzSpan]="24"  >
            <table #basicTable style="margin: 30px 0px; width: 100%;text-align: center;">
                <thead>
                <tr>
                    <th>开发人员</th>
                    <th>代码</th>
                    <th>合并时间</th>
                    <th>变动类型</th>
                    <th>编译为</th>
                    <th>最新版本</th>
                    <th>状态</th>
                    <th>描述</th>
                    <th>操作</th>
                </tr>
                </thead>
                <tbody>
                <tr *ngFor="let j of mergeListData">
                    <td>{{j.author }}</td>
                    <td>{{j.fullPath}}</td>
                    <td>{{j.mergeDate  | date:'yyyy-MM-dd'}}</td>
                    <td>{{j.mergeType}}</td>
                    <td>{{j.partOfProject}}</td>
                    <td>{{j.mergeVersion}}</td>
                    <td>{{j.confirmStatus}}</td>
                    <td nzType="vertical">{{j.developerConfirm}}</td>
                    <td class="d-flex">
                 <button nz-col  [nzSize]="small"  nz-button [nzType]="'danger'"  (click)="buttonClick('3',j.guid)">
                    <span>删除</span>
                </button>
                  <button nz-col  [nzSize]="small" [nzOffset]="1" nz-button [nzType]="'primary'"  (click)="buttonClick('4',j.guid)">
                    <span>加入投放</span>
                </button>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>
           <div nz-row [nzType]="'flex'" [nzJustify]="'start'" nz-col [nzSpan]="24"  *ngFor="let j of checkModalData" >
     
            <div nz-col [nzSpan]="24" class="mb-md">
                <div  nz-form-item class="d-flex">
                    <h2>{{j.delivery.guidWorkitem.target}}</h2>
                </div>
            </div>

            <div nz-col [nzSpan]="6" class="mb-md">
                <div  nz-form-item class="d-flex">
                    <div class="ad-desc-list__term ng-star-inserted words">投放计划:</div>
                    <div class="ad-desc-list__detail ng-star-inserted">{{j.delivery.deliveryTime | date:'yyyy-MM-dd'}}</div>
                </div>
            </div>
            <div nz-col [nzSpan]="6" class="mb-md">
                <div   nz-form-item class="d-flex">
                    <div class="ad-desc-list__term ng-star-inserted">{{j.delivery.guidProfiles.target}}</div>
                    <!--<div class="ad-desc-list__detail ng-star-inserted">{{j.delivery.applyAlias}}</div>-->
                </div>
            </div>

            <div nz-col [nzSpan]="16" class="mb-md">
                <div  nz-form-item class="d-flex">
                    <div class="ad-desc-list__term ng-star-inserted words">工作项:</div>
                    <div class="ad-desc-list__detail ng-star-inserted">{{j.delivery.guidWorkitem.target}}</div>
                </div>
            </div>


            <div nz-col [nzSpan]="12" class="mb-md">
                <div  nz-form-item class="d-flex">
                    <div class="ad-desc-list__term ng-star-inserted words">申请人:</div>
                    <div class="ad-desc-list__detail ng-star-inserted">{{j.delivery.proposer}}</div>
                </div>
            </div>

            <div  nz-col [nzSpan]="24" class="mb-md" *ngFor="let s of j.detailList ; let l = index">
                    <div>
                        <table style="margin:30px 0px;" *ngFor="let k of s.deliveryPatchDetails">
                            <tbody nz-col [nzSpan]="24" style="text-align: center;" >
                            <tr nz-col [nzSpan]="24">
                                <td nz-col [nzSpan]="8">工程名</td>
                                <td nz-col [nzSpan]="16">{{s.projectName}}</td>
                            </tr>

                            <tr nz-col [nzSpan]="24">
                                <td nz-col [nzSpan]="8">编译为</td>
                                <td nz-col [nzSpan]="16">{{k.deployWhere}}</td>
                            </tr>
                            <tr nz-col [nzSpan]="24">
                                <td nz-col [nzSpan]="8">部署到</td>
                                <td nz-col [nzSpan]="16">{{k.patchType }}</td>
                            </tr>
                            <tr nz-col [nzSpan]="24">
                                <td nz-col [nzSpan]="8">代码</td>
                                <td nz-col [nzSpan]="3">变动类型</td>
                                <td nz-col [nzSpan]="3">最新版本</td>
                               
                                <td nz-col [nzSpan]="3">开发人员</td>
                                 <td nz-col [nzSpan]="3">状态</td>
                                <td nz-col [nzSpan]="4">操作</td>
                            </tr>
                            <tr nz-col [nzSpan]="24"  *ngFor="let x of k.fileList">
                                <td nz-col [nzSpan]="8" style="overflow: hidden;text-overflow:ellipsis;white-space: nowrap;"  title="{{x.fullPath}}">{{x.fullPath}}</td>
                                <td nz-col [nzSpan]="3">{{x.commitType}}</td>
                                <td nz-col [nzSpan]="3">{{x.deliveryVersion}}</td>
                                <td nz-col [nzSpan]="3">{{x.author}}</td>
                                <td nz-col [nzSpan]="3">{{x.confirmStatus}}</td>
                                  <td nz-col [nzSpan]="4">
                                    <a  style="color:#108ee9;" (click)="buttonClick(1,x.guid)">已合并&nbsp;</a>&nbsp;
                                    <a style="color:red;" (click)="buttonClick(2,x.guid)">不投产&nbsp;</a>&nbsp;
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
            </div>


            <div  nz-col [nzSpan]="24" class="mb-md">
                    <button  nz-col [nzSpan]="4"  [nzOffset]="'6'" nz-button  (click)="returnsclick(0,j.delivery.guid)"  [nzType]="'primary'" [nzSize]="'large'">
                        <span>打回</span>
                    </button>

                    <button   nz-col  [nzSpan]="4"  [nzOffset]="'3'" nz-button  (click)="returnsclick(1,j.delivery.guid)"  [nzType]="'primary'" [nzSize]="'large'">
                        <span>成功</span>
                    </button>

            </div>
        </div>
         </div>
  </ng-template>
</nz-modal>
<nz-modal [nzVisible]="istextVisible"  [nzWidth]="600" [nzTitle]="'请输入打回理由（选填）'"   [nzContent]="modaltextTitle"
          (nzOnCancel)="istextVisible=false"  (nzOnOk)="returnsclick(2,guid)" >
    <ng-template #modaltextTitle>
        <textarea rows="6"  nz-input [(ngModel)]="inputValue" ></textarea>

    </ng-template>
</nz-modal>